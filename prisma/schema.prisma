// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum LeadStatus {
  NOT_CONTACTED
  CONTACTED
  INTERESTED
  SAMPLE_SENT
  SELLING
  NOT_A_FIT
}

enum ContactType {
  EMAIL
  PHONE
  INSTAGRAM
  WEBSITE
}

enum OutreachChannel {
  EMAIL
  INSTAGRAM
  SMS
  IN_PERSON
}

enum OutreachOutcome {
  NO_REPLY
  REPLIED
  INTERESTED
  NOT_INTERESTED
}

enum TaskStatus {
  TODO
  DOING
  DONE
}

model Lead {
  id           String   @id @default(cuid())
  name         String
  city         String   @default("Dallas")
  category     String?  // fruteria, paleteria, antojitos, etc.
  status       LeadStatus @default(NOT_CONTACTED)
  notes        String?  @db.Text

  contacts     Contact[]
  outreach     OutreachAttempt[]
  tasks        Task[]

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([status])
  @@index([city])
}

model Contact {
  id        String      @id @default(cuid())
  leadId    String
  type      ContactType
  value     String

  lead      Lead        @relation(fields: [leadId], references: [id], onDelete: Cascade)

  createdAt DateTime    @default(now())

  @@index([leadId])
  @@unique([type, value])
}

model OutreachAttempt {
  id        String          @id @default(cuid())
  leadId    String
  channel   OutreachChannel
  subject   String?
  message   String          @db.Text
  outcome   OutreachOutcome @default(NO_REPLY)
  sentAt    DateTime        @default(now())

  lead      Lead            @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([sentAt])
}

model Task {
  id          String     @id @default(cuid())
  title       String
  leadId      String?
  assignedTo  String?    // simple: store "anthony" or "sister" for MVP
  status      TaskStatus @default(TODO)
  dueDate     DateTime?
  notes       String?    @db.Text

  lead        Lead?      @relation(fields: [leadId], references: [id], onDelete: SetNull)

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([status])
  @@index([assignedTo])
  @@index([dueDate])
}
